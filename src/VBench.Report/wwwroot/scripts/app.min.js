var VBench;!function(e){var t=function(){function e(e,t,o,n){void 0===n&&(n=1),this.r=e,this.g=t,this.b=o,this.a=n}return e.prototype.getValue=function(e){return"rgba("+this.r+","+this.g+","+this.b+","+(e||this.a)+")"},e}();e.Color=t}(VBench||(VBench={})),function(t){var e=function(){function e(){this._index=0,this._colors=[new t.Color(11,95,165),new t.Color(255,148,0),new t.Color(59,20,175),new t.Color(255,213,0),new t.Color(116,9,170),new t.Color(251,254,0),new t.Color(0,153,153),new t.Color(255,116,0),new t.Color(0,204,0),new t.Color(255,0,0)],this.textColor=new t.Color(225,225,225),this.backgroundColor=new t.Color(30,30,30)}return e.prototype.newColor=function(){return this._index=this._index<this._colors.length?this._index:0,this._colors[this._index++]},e.prototype.getCurrentColor=function(){return this._colors[this._index]},e}();t.ColorGenerator=e}(VBench||(VBench={})),function(e){var t=function(){function r(){}return r.formatAsTime=function(e){if(e<=1)return e+" ns";var t=["ns","us","ms","s"],o=Math.floor(r.log(1e3,e));e/=Math.pow(Math.pow(10,o),3);var n=t[o];return t.length<=o&&59.999999<e&&(e/=60,n="min"),this.formatAsNumber(e)+" "+n},r.formatAsBytes=function(e){if(e<=1)return e+" B";var t=Math.floor(r.log(1024,e));return e/=Math.pow(1024,t),this.formatAsNumber(e)+" "+["B","KB","MB","GB","TB"][t]},r.formatAsNumber=function(e){return new Intl.NumberFormat(navigator.language).format(e)},r.format=function(e,t){switch(t){case 2:return this.formatAsBytes(e);case 1:return this.formatAsTime(e);default:return this.formatAsNumber(e)}},r.log=function(e,t){return Math.log(t)/Math.log(e)},r}();e.Formatter=t}(VBench||(VBench={})),function(c){var e=function(){function l(e,t,o){if(this.typeId=l.TypeCode,this.row=e,this.columnIndex=t,this.value=ko.observable(),this.difference=ko.observable(),this.isNumeric=ko.observable(!1),this.isSelected=ko.observable(!1),this.isHidden=ko.observable(e.table.columns()[t].isHidden()),window.localStorage){var n="cell"+e.index+t;window.localStorage.getItem(n)}this.computeValue(o,e.table.columns()[t]),this.computeDifference()}return l.prototype.computeValue=function(e,t){if(this.unitKind=t.unitKind,t.isNumeric&&Array.isArray(e)){var o=this.history=e;switch(this.isNumeric(2<=o.length),t.unitKind){default:this.value(o[o.length-1]),this.rawValue=o[o.length-1];break;case 1:case 2:var n=o[o.length-1];this.value(n?n.friendlyValue:null),this.rawValue=n?n.friendlyValue:null}}else this.value(e),this.rawValue=e},l.prototype.getDataPoints=function(){if(!this.isNumeric())return[];var e,t=[];switch(this.unitKind){default:for(var o=0;o<this.history.length;o++)e=this.history[o],t.push("number"==typeof e?e:null);break;case 1:case 2:for(o=0;o<this.history.length;o++)e=this.history[o],t.push(e&&"number"==typeof e.value?e.value:null)}return t},l.prototype.computeDifference=function(){var e,t,o=this.getDataPoints();if(0!==o.length&&(null!==(e=o[o.length-1])&&e!==undefined)){switch(l.comparisonKind){case 0:t=2<=o.length?o[o.length-2]:e;break;case 1:t=e;for(var n=0;n<o.length;n++)o[n]<t&&(t=o[n]);break;case 2:t=e;for(n=0;n<o.length;n++)o[n]>t&&(t=o[n])}if(null!==t&&t!==undefined){var r=t<=e?"+":"-",a=Math.abs(e-t),i=a/(0===t?1:t)*100,s="&Delta; "+r+c.Formatter.format(a,this.unitKind);0===i||(s+=999<i?" (>999%)":" ("+(1<=i?i.toFixed(0):i.toFixed(2))+"%)"),this.difference(s)}}},l.comparisonKind=0,l.TypeCode=3,l}();c.DataCell=e}(VBench||(VBench={})),function(a){var e=function(){function e(e,t){var o=this;this.table=e,this.values=ko.observableArray(),this.key=t[0],this.isSelected=ko.observable(!1),this.index=e.rows().length;for(var n=0;n<t.length;n++){var r=new a.DataCell(this,n,t[n]);a.Service.restoreCell(r),this.values.push(r)}this.isSelected=ko.pureComputed(function(){for(var e=!1,t=0;t<o.values().length;t++)if(o.values()[t].isSelected()){e=!0;break}return e})}return e.prototype.refresh=function(){for(var e=0;e<this.values().length;e++)this.values()[e].computeDifference()},e}();a.DataRow=e}(VBench||(VBench={})),function(o){var e=function(){function e(){this.name=ko.observable(),this.rows=ko.observableArray(),this.columns=ko.observableArray(),this.description=ko.observable(""),this.jobs=ko.observableArray()}return e.prototype.addColumn=function(e){var t=new o.DataColumn(this,e);return o.Service.restoreColumn(t),this.columns.push(t),t},e.prototype.addRow=function(e){var t=new o.DataRow(this,e);return this.rows.push(t),t},e.prototype.refresh=function(){for(var e=0;e<this.rows().length;e++)this.rows()[e].refresh()},e.prototype.clear=function(){this.rows.removeAll(),this.columns.removeAll()},e.prototype.reset=function(){for(var e=0;e<this.columns().length;e++)this.columns()[e].isSelected(!1)},e.prototype.sort=function(){for(var e=0;e<this.columns().length;e++)this.columns()[e].isSelected()&&this.columns()[e].sort(!1)},e}();o.DataTable=e}(VBench||(VBench={})),function(n){var e=function(){function e(e,t){var o=this;this.table=e,this.unitKind=t.unitKind,this.isNumeric=t.isNumeric,this.index=e.columns().length,this.order=ko.observable(0),this.isSelected=ko.observable(!1),this.name=ko.observable(t.name||"-"),this.isHidden=ko.observable(t.isHidden),this.isSelected.subscribe(function(e){n.Service.saveColumn(o)})}return e.prototype.sort=function(e){void 0===e&&(e=!0);var r=this;e&&(this.order(0===this.order()?1:0),this.isSelected(!0),n.Service.saveColumn(this)),console.debug("sorting column["+this.name()+"] "+(0===this.order()?"Asc":"Desc")),0===this.order()?this.table.rows.sort(function(e,t){var o=e.values()[r.index].rawValue,n=t.values()[r.index].rawValue;return n<o?1:o<n?-1:0}):this.table.rows.sort(function(e,t){var o=e.values()[r.index].rawValue,n=t.values()[r.index].rawValue;return n<o?-1:o<n?1:0})},e}();n.DataColumn=e}(VBench||(VBench={})),function(e){var t=function(){function o(){var e=this;this.email=ko.observable(),this.commitId=ko.observable(),this.emailHash=ko.observable(),this.hardwareInformation=ko.observable(),this.date=ko.observable(),this.author=ko.observable(),this.testNo=ko.observable(),this.branch=ko.observable(),this.wasClean=ko.observable(),this.avatar=ko.pureComputed(function(){return"https://www.gravatar.com/avatar/"+e.emailHash()+"?s=32"})}return o.create=function(e){var t=new o;return t.hardwareInformation(e.hardwareInformation),t.emailHash(e.emailMD5),t.email(e.email),t.commitId(e.sha),t.author(e.author),t.branch(e.branch),t.date(new Date(Date.parse(e.date))),t.wasClean(e.wasClean),t},o.prototype.copy=function(e){return this.hardwareInformation(e.hardwareInformation()),this.emailHash(e.emailHash()),this.commitId(e.commitId()),this.email(e.email()),this.date(e.date()),this.author(e.author()),this.branch(e.branch()),this},o}();e.Contributor=t}(VBench||(VBench={})),function(l){var e=function(){function e(e){void 0===e&&(e="data"),this._data=JSON.parse(document.getElementById(e).innerHTML)}return e.prototype.loadData=function(e,t,o){var n=t||new l.DataTable,r=this.fetchDataset(e),a=r.contributions;n.clear(),n.name(e),n.jobs(r.jobs),n.description(a[a.length-1].hardwareInformation);for(var i=r.columns.length,s=0;s<i;s++)n.addColumn(r.columns[s]);for(s=0;s<r.rows.length;s++)n.addRow(r.rows[s]);n.sort(),o.removeAll();for(s=0;s<a.length;s++)o.push(l.Contributor.create(a[s]));return n},e.prototype.fetchDatasetNames=function(){for(var e=[],t=0;t<this._data.length;t++)e.push(this._data[t].name);return e},e.prototype.fetchDataset=function(e){for(var t=0;t<this._data.length;t++)if(this._data[t].name===e)return this._data[t];return null},e}();l.Repository=e}(VBench||(VBench={})),function(e){var t=function(){function e(){}return e.sendHttpRequest=function(e,o,t,n){var r=new XMLHttpRequest;r.open(e,o,!0),r.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r.onreadystatechange=function(){if(4===this.readyState){var e=void 0;try{e=JSON.parse(this.responseText)}catch(t){e=!1}n&&(200===this.status?n(null,e):n({error:"failure: '"+o+"'; "+this.statusText,status:this.status,data:e},e))}},r.send(JSON.stringify(t))},e.getData=function(e,t,o){return this.sendHttpRequest("GET",e,t,o)},e.postData=function(e,t,o){return this.sendHttpRequest("POST",e,t,o)},e.saveComparisonKey=function(e){window.localStorage&&window.localStorage.setItem("DeltaComparison",e.toString())},e.getDeltaComparison=function(){return window.localStorage&&parseInt(window.localStorage.getItem("DeltaComparison"))||0},e.saveColumn=function(e){if(window.localStorage){var t=e.table.name()+"."+e.name()+"_col",o=t+".order";window.localStorage.removeItem(o),window.localStorage.setItem(o,""+e.order()),window.localStorage.setItem(t+".selected",""+e.isSelected())}},e.restoreColumn=function(e){if(window.localStorage){var t=e.table.name()+"."+e.name()+"_col",o=t+".order";e.order(parseInt(window.localStorage.getItem(o))||0),o=t+".selected",e.isSelected(JSON.parse(window.localStorage.getItem(o))||!1)}},e.saveCell=function(e){if(window.localStorage){var t=e.row.table.name()+"."+e.row.table.columns()[e.columnIndex].name()+".row"+e.row.index;e.isSelected()?window.localStorage.setItem(t,""+e.isSelected()):window.localStorage.removeItem(t)}},e.restoreCell=function(e){if(window.localStorage){var t=e.row.table.name()+"."+e.row.table.columns()[e.columnIndex].name()+".row"+e.row.index;e.isSelected(JSON.parse(window.localStorage.getItem(t))||!1)}},e.saveTimeline=function(e){window.localStorage&&window.localStorage.setItem("timeline.lines",""+e.linesEnabled())},e.restoreTimeline=function(e){window.localStorage&&e.linesEnabled(JSON.parse(window.localStorage.getItem("timeline.lines"))||e.linesEnabled)},e}();e.Service=t}(VBench||(VBench={})),function(s){var e=function(){function e(e){this._repository=e,this.data=new s.DataTable,this._colorPicker=new s.ColorGenerator,this._chart=this.createLineChart(),this.linesEnabled=ko.observable(!0),this.contributors=ko.observableArray(),this.selectedContributor=new s.Contributor}return e.prototype.restore=function(){s.Service.restoreTimeline(this);for(var e=0;e<this.data.rows().length;e++)for(var t=this.data.rows()[e].values(),o=0;o<t.length;o++)t[o].isSelected()&&this.updateChart(t[o])},e.prototype.changeDataset=function(e){for(void 0===e&&(e=null),this._selectedDatasetId=e||this._selectedDatasetId,this._repository.loadData(this._selectedDatasetId,this.data,this.contributors),this.selectContributor(0),this._chart.data.labels.splice(0,this._chart.data.labels.length);0<this._chart.data.datasets.length;)this._chart.data.datasets.pop();this._chart.update()},e.prototype.updateChart=function(e){var t=e.row.key,o=e.columnIndex,n=t+" ["+e.row.table.columns()[o].name()+"]";if(e.isSelected()){console.debug(n+" |> add-series");var r=e.getDataPoints();if(0<r.length){this._chart.data.labels.splice(0,this._chart.data.labels.length);for(var a=0;a<r.length;a++)this._chart.data.labels.push("Test-"+(a+1));(i=this.createSeriesBaseSettings()).data=r,i.label=n,i.vbench_unitType=e.unitKind,this._chart.data.datasets.push(i)}else console.debug("toast an error: no history")}else{console.debug(n+" |> remove-series");var i=this._chart.data.datasets;for(a=0;a<i.length;a++)if(i[a].label===n){i.splice(a,1);break}}s.Service.saveCell(e),this._chart.update()},e.prototype.selectContributor=function(e){var t=null;return e<this.contributors().length&&(t=this.selectedContributor.copy(this.contributors()[e])).testNo(e),t},e.prototype.toggleChartLines=function(){var t=this;this.linesEnabled(!this.linesEnabled());var o=this.createSeriesBaseSettings();return s.Service.saveTimeline(this),this._chart.data.datasets.forEach(function(e){e.showLine=t.linesEnabled(),e.pointStyle=o.pointStyle,e.pointRadius=o.pointRadius,e.pointBorderWidth=o.pointBorderWidth}),this._chart.update(),this.linesEnabled()},e.prototype.createLineChart=function(){var n=this,e=this._colorPicker.textColor,t=this._colorPicker.textColor;return new Chart(document.getElementById("chart"),{type:"line",data:{datasets:[]},options:{scales:{xAxes:[{gridLines:{color:t.getValue(.25)},ticks:{fontColor:e.getValue(.75)}}],yAxes:[{gridLines:{display:!0,color:t.getValue(.05)},ticks:{display:!1,beginAtZero:!0,fontColor:e.getValue(.5)}}]},tooltips:{titleFontSize:18,bodyFontSize:18,bodyFontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",cornerRadius:0,xPadding:12,yPadding:12,callbacks:{label:function(e,t){n.selectContributor(e.index);var o=t.datasets[e.datasetIndex];return" "+o.label+": "+s.Formatter.format(o.data[e.index],o.vbench_unitType)},afterBody:function(e,t){return["","Tester: "+n.selectedContributor.author(),"Commit: "+n.selectedContributor.commitId().substring(0,6),""].concat(n.selectedContributor.hardwareInformation().split("\n"))}}}}})},e.prototype.createSeriesBaseSettings=function(){var e=this._colorPicker.newColor();return{fill:!1,pointHitRadius:20,showLine:this.linesEnabled(),backgroundColor:e.getValue(),borderColor:[e.getValue(.75)],pointRadius:this.linesEnabled()?3:20,pointBorderWidth:(this.linesEnabled(),6),pointStyle:this.linesEnabled()?"circle":"line"}},e}();s.Timeline=e}(VBench||(VBench={})),function(i){var e=function(){function e(){this._repository=new i.Repository;var e=this._repository.fetchDatasetNames();this.datasetTabs=ko.observableArray(e),this.selectedDataset=ko.observable(e[0]),i.DataCell.comparisonKind=i.Service.getDeltaComparison(),this.timeline=new i.Timeline(this._repository),this.timeline.changeDataset(e[0]),this.timeline.restore()}return e.prototype.attachEventHandlers=function(){var n=this;document.getElementById("timeline-table").addEventListener("click",function(e){var t=ko.contextFor(e.target);if(t.$data.typeId===i.DataCell.TypeCode){var o=t.$data;o.isNumeric()&&(o.isSelected(!o.isSelected()),n.timeline.updateChart(o))}});var e=document.getElementById("chart-lines-btn");e&&e.addEventListener("click",function(e){n.timeline.toggleChartLines()});var t=document.getElementById("compute-menu");t&&(t.selectedIndex=i.DataCell.comparisonKind,t.addEventListener("click",function(e){i.DataCell.comparisonKind=t.selectedIndex,i.Service.saveComparisonKey(i.DataCell.comparisonKind),n.timeline.data.refresh()},{passive:!0}));for(var r=document.getElementsByClassName("tab-btn"),o=0;o<r.length;o++)r[o].addEventListener("click",function(e){for(var t=0;t<r.length;t++)r[t].classList.remove("is-active");var o=ko.contextFor(this);this.classList.add("is-active"),n.timeline.changeDataset(o.$data),n.selectedDataset(o.$data)});r[0].classList.add("is-active");var a=document.getElementsByClassName("sortable");for(o=0;o<a.length;o++)a[o].addEventListener("click",function(e){n.timeline.data.reset(),ko.contextFor(this).$data.sort()})},e}();i.HomePage=e}(VBench||(VBench={}));
//# sourceMappingURL=app.min.js.map